<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Performance Detection System</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <nav class="bg-blue-600 p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-white text-xl font-bold">Student Performance System</h1>
            <div class="space-x-4">
                <button id="dashboardBtn" class="text-white hover:text-blue-200">Dashboard</button>
                <button id="profileBtn" class="text-white hover:text-blue-200">Student Profile</button>
                <button id="analyticsBtn" class="text-white hover:text-blue-200">Analytics</button>
                <button id="adminBtn" class="text-white hover:text-blue-200">Admin</button>
            </div>
        </div>
    </nav>

    <div id="content" class="container mx-auto p-6">
        <!-- Dashboard Content -->
        <div id="dashboard" class="content-section">
            <h1 class="text-3xl font-bold mb-6">Student Performance Dashboard</h1>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-2">Total Students</h2>
                    <p class="text-3xl font-bold text-blue-600">1,247</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-2">At-Risk Students</h2>
                    <p class="text-3xl font-bold text-red-600">156</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-2">Average GPA</h2>
                    <p class="text-3xl font-bold text-green-600">3.2</p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">System Status</h2>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>Backend API:</span>
                        <span id="backendStatus" class="text-green-600">Checking...</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ML Service:</span>
                        <span id="mlStatus" class="text-yellow-600">Checking...</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Database:</span>
                        <span id="dbStatus" class="text-green-600">Connected</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Student Profile Content -->
        <div id="profile" class="content-section hidden">
            <h1 class="text-3xl font-bold mb-6">Student Profile</h1>

            <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-xl font-semibold mb-4">Performance Prediction</h2>
                <form id="predictionForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Attendance %</label>
                        <input type="number" id="attendance" class="mt-1 block w-full border border-gray-300 rounded-md p-2" value="85">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Internal Marks</label>
                        <input type="number" id="internal_marks" class="mt-1 block w-full border border-gray-300 rounded-md p-2" value="78">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Assignment Scores</label>
                        <input type="number" id="assignment_scores" class="mt-1 block w-full border border-gray-300 rounded-md p-2" value="82">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Lab Performance</label>
                        <input type="number" id="lab_performance" class="mt-1 block w-full border border-gray-300 rounded-md p-2" value="80">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Previous GPA</label>
                        <input type="number" step="0.1" id="previous_gpa" class="mt-1 block w-full border border-gray-300 rounded-md p-2" value="3.2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Study Hours/Week</label>
                        <input type="number" id="study_hours" class="mt-1 block w-full border border-gray-300 rounded-md p-2" value="25">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Participation %</label>
                        <input type="number" id="participation" class="mt-1 block w-full border border-gray-300 rounded-md p-2" value="90">
                    </div>
                    <div class="md:col-span-2">
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">
                            Get Prediction
                        </button>
                    </div>
                </form>
            </div>

            <div id="predictionResult" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h2 class="text-xl font-semibold mb-4">Prediction Results</h2>
                <div id="resultContent"></div>
            </div>
        </div>

        <!-- Analytics Content -->
        <div id="analytics" class="content-section hidden">
            <h1 class="text-3xl font-bold mb-6">Analytics Dashboard</h1>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">Model Performance</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-2 text-left">Model</th>
                                <th class="px-4 py-2 text-left">Accuracy</th>
                                <th class="px-4 py-2 text-left">F1-Score</th>
                                <th class="px-4 py-2 text-left">CV F1-Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-t">
                                <td class="px-4 py-2">XGBoost</td>
                                <td class="px-4 py-2">88%</td>
                                <td class="px-4 py-2">0.87</td>
                                <td class="px-4 py-2">0.84</td>
                            </tr>
                            <tr class="border-t">
                                <td class="px-4 py-2">Random Forest</td>
                                <td class="px-4 py-2">86%</td>
                                <td class="px-4 py-2">0.85</td>
                                <td class="px-4 py-2">0.88</td>
                            </tr>
                            <tr class="border-t">
                                <td class="px-4 py-2">Logistic Regression</td>
                                <td class="px-4 py-2">86%</td>
                                <td class="px-4 py-2">0.86</td>
                                <td class="px-4 py-2">0.85</td>
                            </tr>
                            <tr class="border-t">
                                <td class="px-4 py-2">Neural Network</td>
                                <td class="px-4 py-2">84%</td>
                                <td class="px-4 py-2">0.83</td>
                                <td class="px-4 py-2">0.84</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Admin Content -->
        <div id="admin" class="content-section hidden">
            <h1 class="text-3xl font-bold mb-6">Admin Panel</h1>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">System Information</h2>
                <div class="space-y-2">
                    <p><strong>Project:</strong> Student Performance Detection & Improvement System</p>
                    <p><strong>Version:</strong> 1.0.0</p>
                    <p><strong>Models Trained:</strong> 4 ML algorithms</p>
                    <p><strong>Dataset Size:</strong> 10,000+ student records</p>
                    <p><strong>Architecture:</strong> Microservices (FastAPI + React)</p>
                    <p><strong>Database:</strong> SQLite</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Navigation
        const sections = ['dashboard', 'profile', 'analytics', 'admin'];
        const buttons = ['dashboardBtn', 'profileBtn', 'analyticsBtn', 'adminBtn'];

        buttons.forEach((btnId, index) => {
            document.getElementById(btnId).addEventListener('click', () => {
                sections.forEach(section => {
                    document.getElementById(section).classList.add('hidden');
                });
                document.getElementById(sections[index]).classList.remove('hidden');
            });
        });

        // Check backend status
        async function checkBackendStatus() {
            try {
                const response = await fetch('http://localhost:8002/health');
                if (response.ok) {
                    document.getElementById('backendStatus').textContent = 'Running';
                    document.getElementById('backendStatus').className = 'text-green-600';
                } else {
                    throw new Error();
                }
            } catch (error) {
                document.getElementById('backendStatus').textContent = 'Not Available';
                document.getElementById('backendStatus').className = 'text-red-600';
            }
        }

        async function checkMLStatus() {
            try {
                const response = await fetch('http://localhost:8001/health');
                if (response.ok) {
                    document.getElementById('mlStatus').textContent = 'Running';
                    document.getElementById('mlStatus').className = 'text-green-600';
                } else {
                    throw new Error();
                }
            } catch (error) {
                document.getElementById('mlStatus').textContent = 'Not Available';
                document.getElementById('mlStatus').className = 'text-yellow-600';
            }
        }

        // Prediction form
        document.getElementById('predictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                student_id: 1,
                attendance_percentage: parseFloat(document.getElementById('attendance').value),
                internal_marks: parseFloat(document.getElementById('internal_marks').value),
                assignment_scores: parseFloat(document.getElementById('assignment_scores').value),
                lab_performance: parseFloat(document.getElementById('lab_performance').value),
                previous_gpa: parseFloat(document.getElementById('previous_gpa').value),
                study_hours: parseFloat(document.getElementById('study_hours').value),
                socio_academic_factors: '{}',
                participation_metrics: parseFloat(document.getElementById('participation').value)
            };

            try {
                const response = await fetch('http://localhost:8002/api/predictions/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    displayPredictionResult(result);
                } else {
                    throw new Error('Prediction failed');
                }
            } catch (error) {
                displayPredictionResult({
                    predicted_performance: 'Error',
                    risk_score: 0,
                    recommendations: ['Unable to get prediction. Please check if ML service is running.'],
                    feature_importance: {}
                });
            }
        });

        function displayPredictionResult(result) {
            const resultDiv = document.getElementById('predictionResult');
            const contentDiv = document.getElementById('resultContent');

            contentDiv.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="p-4 border rounded">
                        <h3 class="font-semibold">Predicted Performance</h3>
                        <p class="text-2xl font-bold ${getPerformanceColor(result.predicted_performance)}">
                            ${result.predicted_performance}
                        </p>
                    </div>
                    <div class="p-4 border rounded">
                        <h3 class="font-semibold">Risk Score</h3>
                        <p class="text-2xl font-bold ${result.risk_score > 0.5 ? 'text-red-600' : 'text-green-600'}">
                            ${(result.risk_score * 100).toFixed(1)}%
                        </p>
                    </div>
                </div>
                <div class="mb-4">
                    <h3 class="font-semibold mb-2">Recommendations</h3>
                    <ul class="list-disc list-inside space-y-1">
                        ${result.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold mb-2">Feature Importance</h3>
                    <div class="space-y-1">
                        ${Object.entries(result.feature_importance).map(([feature, importance]) =>
                            `<div class="flex justify-between">
                                <span>${feature.replace(/_/g, ' ')}</span>
                                <span>${(importance * 100).toFixed(1)}%</span>
                            </div>`
                        ).join('')}
                    </div>
                </div>
            `;

            resultDiv.classList.remove('hidden');
        }

        function getPerformanceColor(performance) {
            switch(performance.toLowerCase()) {
                case 'high': return 'text-green-600';
                case 'medium': return 'text-yellow-600';
                case 'low': return 'text-red-600';
                default: return 'text-gray-600';
            }
        }

        // Initialize
        checkBackendStatus();
        checkMLStatus();

        // Check status every 30 seconds
        setInterval(() => {
            checkBackendStatus();
            checkMLStatus();
        }, 30000);
    </script>
</body>
</html>